{% extends "base.html" %} {% block title %}대시보드 - TeckwahKR TMS{% endblock
%} {% block page_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', path='css/dashboard.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for('static', path='css/dashboard_additions.css') }}"
/>
{% endblock %} {% block content %}
<div class="dashboard-page">
  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <p>데이터를 불러오는 중입니다...</p>
    </div>
  </div>

  <div class="main-card">
    <!-- 페이지 제목 -->
    <div class="page-header">
      <h2 class="page-title">대시보드</h2>
    </div>

    <!-- 필터 바 -->
    <div class="filter-bar">
      <div class="top-filter-row">
        <!-- 날짜 범위 선택 -->
        <div class="date-range-filter">
          <div class="filter-item">
            <label for="startDate">시작일</label>
            <input type="date" id="startDate" class="date-input" />
          </div>
          <span class="date-separator">~</span>
          <div class="filter-item">
            <label for="endDate">종료일</label>
            <input type="date" id="endDate" class="date-input" />
          </div>
          <button
            type="button"
            id="todayBtn"
            class="btn secondary-btn"
            title="오늘 날짜로 설정"
          >
            <i class="fa-solid fa-calendar-day"></i> 오늘
          </button>
          <button
            type="button"
            id="dateSearchBtn"
            class="btn primary-btn date-search-btn"
          >
            <i class="fa-solid fa-search"></i> 조회
          </button>
        </div>
        <!-- 주문번호 검색 -->
        <div class="search-container">
          <div class="search-box">
            <input
              type="text"
              id="orderNoSearch"
              class="search-input"
              placeholder="주문번호 검색"
            />
            <button type="button" id="orderSearchBtn" class="search-btn">
              <i class="fa-solid fa-search"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- 필터링 요소들 -->
      <div class="filter-controls">
        <div class="filter-item">
          <label for="statusFilter">상태</label>
          <select id="statusFilter" class="filter-select">
            <option value="">전체</option>
            <option value="WAITING">대기</option>
            <option value="IN_PROGRESS">진행</option>
            <option value="COMPLETE">완료</option>
            <option value="ISSUE">이슈</option>
            <option value="CANCEL">취소</option>
          </select>
        </div>
        <div class="filter-item">
          <label for="departmentFilter">부서</label>
          <select id="departmentFilter" class="filter-select">
            <option value="">전체</option>
            <option value="CS">CS</option>
            <option value="HES">HES</option>
            <option value="LENOVO">LENOVO</option>
          </select>
        </div>
        <div class="filter-item">
          <label for="driverNameFilter">기사명</label>
          <input
            type="text"
            id="driverNameFilter"
            class="filter-input"
            placeholder="기사명 검색"
          />
        </div>
        <!-- 창고 필터 제거 (요구사항 아님) -->
        <!-- <button class="btn secondary-btn" id="applyFilterBtn"> 필터 적용 </button> -->
        <button class="btn secondary-btn" id="resetFilterBtn">
          <i class="fa-solid fa-rotate-left"></i> 초기화
        </button>
      </div>

      <!-- 액션 버튼 영역 -->
      <div class="actions-row">
        <div class="left-actions">
          <button class="btn secondary-btn" id="customizeColumnsBtn">
            <i class="fa-solid fa-table-columns"></i> 컬럼 설정
          </button>
          <div class="filter-item rows-per-page">
            <select id="rowsPerPageSelect" class="filter-select">
              <option value="30">30 행</option>
              <option value="50">50 행</option>
              <option value="100">100 행</option>
            </select>
          </div>
        </div>
        <div class="right-actions">
          <button class="btn secondary-btn" id="refreshBtn">
            <i class="fa-solid fa-arrows-rotate"></i> 새로고침
          </button>
          <!-- 관리자만 볼 수 있는 엑셀 다운로드 버튼 -->
          {% if current_user and current_user.user_role == 'ADMIN' %}
          <button class="btn secondary-btn" id="exportExcelBtn">
            <i class="fa-solid fa-file-excel"></i> 엑셀 다운로드
          </button>
          {% endif %}
          <a href="/orders/new" class="btn primary-btn">
            <i class="fa-solid fa-plus"></i> 신규 등록
          </a>
        </div>
      </div>
    </div>

    <!-- 컬럼 커스터마이징 대화상자 -->
    <div id="columnDialog" class="dialog">
      <div class="dialog-content">
        <h3>테이블 컬럼 설정</h3>
        <p>표시할 컬럼을 선택하세요:</p>
        <div class="columns-grid" id="columnSettingsGrid">
          <!-- JS로 컬럼 목록 동적 생성 예정 -->
        </div>
        <div class="dialog-actions">
          <button type="button" class="btn secondary-btn" id="cancelColumnsBtn">
            취소
          </button>
          <button type="button" class="btn primary-btn" id="applyColumnsBtn">
            적용
          </button>
        </div>
      </div>
    </div>

    <!-- 데이터 테이블 -->
    <div class="table-scroll-container">
      <div class="table-container">
        <table class="data-table" id="dashboardTable">
          <thead id="dashboardTableHead">
            <!-- JS로 헤더 동적 생성 예정 -->
          </thead>
          <tbody id="dashboardTableBody">
            <!-- JS로 데이터 로드 및 렌더링 예정 -->
            <tr class="initial-loading-row">
              <td colspan="10" class="empty-table">
                <div class="empty-placeholder">
                  <i class="fa-solid fa-spinner fa-spin"></i>
                  <p>데이터를 로딩 중입니다...</p>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 페이지네이션 -->
    <div class="pagination-container">
      <div class="pagination" id="paginationControls">
        <button class="page-btn" data-page="prev" disabled>
          <i class="fa-solid fa-chevron-left"></i>
        </button>
        <span class="page-info" id="pageInfo">- / -</span>
        <button class="page-btn" data-page="next" disabled>
          <i class="fa-solid fa-chevron-right"></i>
        </button>
      </div>
    </div>

    <!-- 오류 메시지 표시 영역 -->
    <div
      id="errorMessageContainer"
      class="error-message-container"
      style="display: none"
    >
      <div class="alert alert-danger">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span id="errorMessageText"></span>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block page_js %}

<!-- 대시보드 관련 스크립트 -->
<script src="{{ url_for('static', path='js/dashboard.js') }}"></script>

{% endblock %}
